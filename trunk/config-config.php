<?php
		 if($_POST['action'] == 'generate') {
		 	$type= $_POST['db_type'];
			$name= $_POST['db_name'];
			$user= $_POST['username'];
			$pass= $_POST['db_pass'];
			$host= $_POST['host'];
			if(isset($type) && isset($name) && isset($user) && isset($pass) && isset($host)) {
				$config_content= "<?php\n/* Planetoid configuration file */\n/* Generated by Planetoid on ".date('r')." */\n\ndefine('SQL_TYPE', '$type');\ndefine('SQL_USER', '$user');\ndefine('SQL_PASS', '$pass');\ndefine('SQL_DB_NAME', '$name');\ndefine('SQL_HOST', '$host');\ndefine('SQL_PORT', 5432);\n?>\n";
				if(is_writable('config.php')) {
					$config= fopen('config.php', 'w+');
// 					ftruncate($config, filesize($config));
					sleep(1);
					fwrite($config, $config_content);
					fclose($config);
					$configured= true;
				} else {
					$error= "config.php is not writeable! Try: <pre>chmod 755 config.php</pre>";
				}
			} else {
				$error= "You have to fill all fields";
			}
		 }
		 ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head profile="http://gmpg.org/xfn/11">
		<meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8" />
		<title>Planetoid configuration</title>
		<link href="admin/inc/css/login-install.css" rel="stylesheet" />
		<link href="admin/inc/favicon.css" rel="icon" />
		<link href="admin/inc/favicon.css" rel="shortcut icon" />
	</head>
	<body>
		<form action="config-config.php" method="POST" class="install">
			<img src="admin/inc/images/logo-login.png" alt="Planetoid's logo" />
			<?php if(isset($error)) { ?>
			<div class="error">
				<?php echo $error; ?>
			</div>
			<?php }; ?>
			<div class="info-info">
				<?php if($configured) { ?>
				Your configuration file has been saved.
				<?php } else { ?>
				Here you can configure your config.php before you install Planetoid.
				<?php }; ?>
			</div>
			<hr/>
			<label for="db_type">Database:</label>
			<select name="db_type" id="db_type">
				<option value="pgsql">PostgreSQL</option>
				<option value="mysql">MySQL</option>
			</select>
			
			<label for="host">Host:</label>
			<input type="text" name="host" id="host" value="localhost" /><br/>
			
			<label for="db_name">Database name:</label>
			<input type="text" name="db_name" id="db_name" value="planetoid" /><br/>
			
			<label for="username">Username:</label>
			<input type="text" name="username" id="username" value="<?php echo $user; ?>" /><br/>
			
			<label for="db_pass">Password:</label>
			<input type="password" name="db_pass" id="db_pass" value="<?php echo $pass; ?>" /><br/>
			
			<input type="hidden" name="action" value="generate" />
			<p>
				<small><a href="install.php">Install Planetoid</a></small>
				<input type="submit" value="Save configuration &raquo;" />
			</p>
		</from>
	</body>
</html>
